
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Securing Git Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../security_resources/DSP_Appsec_Onboarding_Doc/" />
    
    
    <link rel="prev" href="../cloud_security/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../security_activities/appsec/">
            
                <a href="../../security_activities/appsec/">
            
                    
                    AppSec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../security_activities/compliance/">
            
                <a href="../../security_activities/compliance/">
            
                    
                    Compliance
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../secure_development/secure_coding/">
            
                <a href="../../secure_development/secure_coding/">
            
                    
                    Secure Coding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../secure_development/security_sdlc/">
            
                <a href="../../secure_development/security_sdlc/">
            
                    
                    Secure SDLC
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../cloud_security/">
            
                <a href="../cloud_security/">
            
                    
                    Cloud Security
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter active" data-level="4.1" data-path="./">
            
                <a href="./">
            
                    
                    Securing Git
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../security_resources/DSP_Appsec_Onboarding_Doc/">
            
                <a href="../../security_resources/DSP_Appsec_Onboarding_Doc/">
            
                    
                    Onboarding
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Securing Git</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <ul>
<li><a href="#what-to-do-when-a-secret-is-accidentally-committed-in-source-code">What to do when a secret is accidentally committed in source
code?</a></li>
<li><a href="#how-do-i-verify-git-secrets-works-on-my-machine">How do I verify git-secrets works on my
machine?</a></li>
<li><a href="#manually-installing-git-secrets">Manually installing git-secrets</a></li>
<li><a href="#detecting-commited-secrets-into-git-repositories---server-side">Detecting commited secrets into git repositories -
Server-Side</a></li>
<li><a href="#repository-integrity-with-signed-commits">Repository Integrity With Signed
Commits</a></li>
<li><a href="#references">References</a></li>
</ul>
<p>Below are some items to consider in order to protect git repositories.</p>
<h1 id="what-to-do-when-a-secret-is-accidentally-committed-in-source-code">What to do when a secret is accidentally committed in source code?</h1>
<p>Secrets, such as private keys or API tokens, are regularly leaked by
developers in source code repositories. More often than not this happens
by accident. Accidents happen, however it&apos;s important that the necessary
steps are taken as part of mitigation</p>
<p>Examples of sensitive information:</p>
<ul>
<li>API tokens</li>
<li>Private Keys</li>
<li>GCP, AWS, Azure Keys</li>
<li>Passwords, DB Credentials</li>
<li>Confidential logs, etc.</li>
</ul>
<p>Post-incident step to take:</p>
<p>Note</p>
<p><strong>Step 1</strong>: First things first, rotate your credentials. Once you have
pushed a commit to Github, you should consider any data it contains to
be compromised.</p>
<p>Note</p>
<p><strong>Step 2:</strong>: Remove sensitive info from git history as well:
<a href="https://help.github.com/en/articles/removing-sensitive-data-from-a-repository" target="_blank">https://help.github.com/en/articles/removing-sensitive-data-from-a-repository</a></p>
<p>Note</p>
<p><strong>Step 3:</strong> Review access logs to see if there was some suspicious
activity. If you do find suspicious activity please reach out to <span class="title-ref">appsec@broadinstitute.org</span>.</p>
<p>Some secrets can lead to other secrets. E.g. Slack tokens can give
access to messages and shared files generally containing other secrets.
GitHub tokens can give access to private repositories also containing
secrets. Depending on your findings, if part of your infrastructure or
data has been further exposed, you may need to take additional
mitigation actions.</p>
<h1 id="how-do-i-verify-git-secrets-works-on-my-machine">How do I verify git-secrets works on my machine?</h1>
<p>Note</p>
<p>Step 1: Verify package is installed <span class="title-ref">git-secrets</span></p>
<p>Note</p>
<p>Step 1: Verify rules are enabled</p>
<h1 id="manually-installing-git-secrets">Manually installing git-secrets</h1>
<p>To prevent any secrets that we might accidentally commit to the GitHub
repository, we may want to use the git-secrets developed by the awslabs
for our repository to keep safe during development.</p>
<p>The following snippet downloads, installs, and configures git-secrets
for repositories initiated or cloned <em>in the future</em>.</p>
<pre><code>git clone https://github.com/awslabs/git-secrets.git
(cd git-secrets &amp;&amp; sudo make install)
git secrets --register-aws --global
git secrets --install ~/.git-templates/git-secrets
git secrets --add --global &apos;BEGINPRIVATEKEY.*ENDPRIVATEKEY&apos; # google private key pattern
git config --global init.templateDir ~/.git-templates/git-secrets
</code></pre><p>Now enable git-secrets for each <em>current</em> repository with</p>
<pre><code>(cd path/to/my/repo &amp;&amp; git secrets --install)
</code></pre><p><strong>GCP Example</strong></p>
<pre><code>{
  &quot;type&quot;: &quot;service_account&quot;,
  &quot;project_id&quot;: &quot;my_gcp_account_id&quot;,
  &quot;private_key_id&quot;: &quot;333d1d68bef68da9ec765f03c5d9bb3457ab92af&quot;,
  &quot;private_key&quot;: &quot;-----BEGINPRIVATEKEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAACFwAAAAdz\nNhAAAAAwEAAQAAAgEAtKqj5MX24mM+TaqUdK2h8tMDzOal/ScR9x4P7fHo77urCM\nhMAi07122VBmD9JB5BOX3Wo6xhaB3t9aKnTSShP736NXS8n7bQpq8deyn7UwCuwl\nOVBYSyb6NpwdsIVJ7/nPFz9jKPpPepMd5StJmr8V5rJTP9xFLFewcudyDNk32gv6\njWalhBVloppiKAExq+utChjkR3w4UvAlzmWOlhH/Gyqk1Dc4aKwm9yZAF+kJPtzQ\nCQyJogDbiGtmFwZVp/Bo+FM8qV3hEk7VKqXL91zhQaZ1YldNY31IoGdolj7tUg1I\nOMWGaZYzdiUGYHX6+ZyN//ndoCMNM2SBfHSp1pFi01H7SmyXsiDLSOQFjp9TBDeP\nMwPqUNKJ9+zevXLE2Qk4LxGW/M/Nbiu/OocdkPY8me7DzkgCiUYeoNNon7533THY\nGeH7XgZ70mJUTeakAEeEUa/0Jicp1lW7FFUutRYCRnzXFo2zpm3G2f3RXCwozeuw\n753YbRbU5F+PK7ZVDlXH2sUr4A1yIXCdnf6ubcsvp9h+slUv+Uae/sPrir1RI2Js\nBzcsoZ5FHp6FrmqyueRUbh/0nwLCOe+eZP4aJ9mNDG8nAtTDH2MhO8BrUWtwD9pJ\ncAAAdwShe7oEoXu6AAAAAHc3NoLXJzYQAAAgEAtKqj5MX24mM+TaqUdK2h8tMDzO\n9x4P7fHo77urCMBDh3uPhMAi07122VBmD9JB5BOX3Wo6xhaB3t9aKnTSShP736NX\npq8deyn7UwCuwl+4w5GNOVBYSyb6NpwdsIVJ7/nPFz9jKPpPepMd5StJmr8V5rJT\newcudyDNk32gv6/T7gaajWalhBVloppiKAExq+utChjkR3w4UvAlzmWOlhH/Gyqk\nwm9yZAF+kJPtzQjxVGFlCQyJogDbiGtmFwZVp/Bo+FM8qV3hEk7VKqXL91zhQaZ1\n3G2f3RXCwozeuwNaYh5c753YbRbU5F+PK7ZVDlXH2sUr4A1yIXCdnf6ubcsvp9h+\nae/sPrir1RI2Jsci97e0BzcsoZ5FHp6FrmqyueRUbh/0nwLCOe+eZP4aJ9mNDG8n\nMhO8BrUWtwD9pJDWmGZxcAAAADAQABAAACABXyOJB8v73GYnYax4fY47hUi7yjM/\ncabs4OfmOyOH/2wAxXFRyalA9aP2UT+QwfJLswHxeow/ha0mIpTPtg/Ll6gV9m+9\nJAGnGuF9Tr1L1WzkTGxu5xrR9EkX879SoaWmCdMAHzKGHYt9PX9uH7XNioKInPY/\nDVfpQy+sbg9681qRsMqGcoq18q+q40uKwZbpvQ5h8bEBVPI2O9Fzort2GjAZoQYq\nu5CMYex8G8HxWSdv4U8VF873HbPXoAIiAduxp36q1c6ZGdMYgmp402sL/Ez2RIIa\ndsGFdP85IpDNxe0EbtZqoCZJWZzHJjWXJfVabNrwrBmLpzc10VaiI4JBVj8zwOp7\nptZrhhAjLTt5kkWs00gHLLxOsC6Ni3Ni4BuvPFE8rs0svt1BONEmV1zeFHJWNKxE\nljZWFjY291bnQuY29tAQIDBAU=\n-----ENDPRIVATEKEY-----&quot;,
  &quot;client_email&quot;: &quot;my_gcp_email@my_gcp_account_id.iam.gserviceaccount.com&quot;,
  &quot;client_id&quot;: &quot;300698269862192074801&quot;,
  &quot;auth_uri&quot;: &quot;https://accounts.google.com/o/oauth2/auth&quot;,
  &quot;token_uri&quot;: &quot;https://oauth2.googleapis.com/token&quot;,
  &quot;auth_provider_x509_cert_url&quot;: &quot;https://www.googleapis.com/oauth2/v1/certs&quot;,
  &quot;client_x509_cert_url&quot;: &quot;https://www.googleapis.com/robot/v1/metadata/x509/my_gcp_email@my_gcp_account_id.iam.gserviceaccount.com&quot;
}
</code></pre><p><strong>AWS Example</strong></p>
<pre><code>x =&quot;AKIAABCDEFGHIJKLMNOP&quot;,&quot;H/A604MMvmQjLuZw/xxxxxxxxxxxxxxxxxxxxxxx&quot;
</code></pre><h1 id="detecting-commited-secrets-into-git-repositories---server-side">Detecting commited secrets into git repositories - Server-Side</h1>
<p>For server-side detection of secrets we have implemented controls and as
a developer the only thing you need to do is watch out for any alerts
communicated by the DSP AppSec team as we closely monitor these alerts
in case there&apos;s any accidental commit of secrets.</p>
<h1 id="repository-integrity-with-signed-commits">Repository Integrity With Signed Commits</h1>
<p>This is important because it helps ensure repository integrity. When
someone has write access to a repository is is very easy to spoof
commits pretending to be someone else. However there is also an external
attack vector for those projects that accept PRs from outside
collaborators. Example shown below.</p>
<p>Note</p>
<p>Scenario 1 - legit commit</p>
<p><img src="../../attachments/legit-commit.png" alt="image"></p>
<p>Note</p>
<p><strong>Scenario 2 - spoofed commit from user who has access to repo</strong></p>
<p><img src="../../attachments/fake-commit.png" alt="image"></p>
<p>Note</p>
<p><strong>Scenario 3 - spoofed commit via PR as an outside collaborator</strong></p>
<p><img src="../../attachments/outside-pr.png" alt="image"></p>
<p><strong>Steps to follow to setup commit signing are located below.</strong>
Alternatively you can just run the following
<a href="https://github.com/broadinstitute/dsp-security-knowledgebase/blob/master/source/scripts/gitsign.sh" target="_blank">script</a>.
Please ensure you have <a href="https://gpgtools.org/" target="_blank">installed gpg</a>. prior to
running the script.</p>
<ul>
<li>Generate a GPG key:
<a href="https://help.github.com/en/articles/generating-a-new-gpg-key" target="_blank">https://help.github.com/en/articles/generating-a-new-gpg-key</a></li>
<li>Add the GPG key to your github account:
<a href="https://help.github.com/en/articles/adding-a-new-gpg-key-to-your-github-account" target="_blank">https://help.github.com/en/articles/adding-a-new-gpg-key-to-your-github-account</a></li>
<li>Start signing commits:
<a href="https://help.github.com/en/articles/signing-commits" target="_blank">https://help.github.com/en/articles/signing-commits</a></li>
</ul>
<p>Note</p>
<p><strong>(Recommended)</strong> Set up Automatic Signing To remove the hassle of
always remembering to sign your commits, you can configure Git to sign
all your commits automatically as you create them.</p>
<pre><code>git config &#x2013;-global commit.gpgsign true
</code></pre><h1 id="references">References</h1>
<ul>
<li><a href="https://cloudplatform.googleblog.com/2017/07/help-keep-your-Google-Cloud-service-account-keys-safe.html" target="_blank">https://cloudplatform.googleblog.com/2017/07/help-keep-your-Google-Cloud-service-account-keys-safe.html</a></li>
<li><a href="https://git-scm.com/book/en/v2/Git-Tools-Signing-Your-Work" target="_blank">https://git-scm.com/book/en/v2/Git-Tools-Signing-Your-Work</a></li>
<li><a href="https://mikegerwitz.com/2012/05/a-git-horror-story-repository-integrity-with-signed-commits" target="_blank">https://mikegerwitz.com/2012/05/a-git-horror-story-repository-integrity-with-signed-commits</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../cloud_security/" class="navigation navigation-prev " aria-label="Previous page: Cloud Security">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../security_resources/DSP_Appsec_Onboarding_Doc/" class="navigation navigation-next " aria-label="Next page: Onboarding">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Securing Git","level":"4.1","depth":1,"next":{"title":"Onboarding","level":"5.1","depth":1,"path":"security_resources/DSP_Appsec_Onboarding_Doc/index.md","ref":"security_resources/DSP_Appsec_Onboarding_Doc/index.md","articles":[]},"previous":{"title":"Cloud Security","level":"3.1","depth":1,"path":"security_platform_categories/cloud_security/index.md","ref":"security_platform_categories/cloud_security/index.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"security_platform_categories/securing_git/index.md","mtime":"2019-10-30T19:33:44.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-10-31T16:06:45.913Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

